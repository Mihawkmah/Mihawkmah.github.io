<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Scrapy爬虫入门[四] | Pandas数据分析Top100电影 · 末小山 | 胡言乱语 万念俱寂</title><meta name="description" content="Scrapy爬虫入门[四] | Pandas数据分析Top100电影 - Mihawkmah"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://Mihawkmah.github.io/atom.xml" title="末小山 | 胡言乱语 万念俱寂"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">我的</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">胶囊</a></li><li class="nav-list-item"><a href="http://mihawkmah.lofter.com/" target="_blank" class="nav-list-link">摄影</a></li><li class="nav-list-item"><a href="https://github.com/mihawkmah" target="_blank" class="nav-list-link">足迹</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Scrapy爬虫入门[四] | Pandas数据分析Top100电影</h1><div class="post-info">2017年9月30日</div><div class="post-content"><h3 id="连接MongoDB并清洗数据"><a href="#连接MongoDB并清洗数据" class="headerlink" title="连接MongoDB并清洗数据"></a>连接MongoDB并清洗数据</h3><h4 id="安装Pymongo"><a href="#安装Pymongo" class="headerlink" title="安装Pymongo"></a>安装Pymongo</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># 安装anaconda（包含 Numpy、Pandas、Matplotlib、SciPy、Seaborn）</div><div class="line">pyenv install anaconda</div><div class="line"></div><div class="line"># 安装jieba分词</div><div class="line">pip install jieba</div><div class="line"></div><div class="line"># 安装scikit-learn</div><div class="line">pip install -U scikit-learn 或 conda install scikit-learn</div><div class="line"></div><div class="line"># 安装PyMongo</div><div class="line">conda install pymongo</div></pre></td></tr></table></figure>
<a id="more"></a>
<h4 id="建立连接"><a href="#建立连接" class="headerlink" title="建立连接"></a>建立连接</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">import pymongo</div><div class="line"></div><div class="line">client = pymongo.MongoClient(host=&apos;localhost&apos;,port=27017)</div><div class="line"># 获取数据库，mtime为数据库名称</div><div class="line">db = client.mtime</div><div class="line"># 获取集合，movietop100为集合名称</div><div class="line">movies = db.movietop100</div></pre></td></tr></table></figure>
<h4 id="Pymongo指令"><a href="#Pymongo指令" class="headerlink" title="Pymongo指令"></a>Pymongo指令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"># 存储单个数据</div><div class="line">document = &#123;&apos;x&apos;:1&#125;</div><div class="line">movies.insert_one(document)</div><div class="line"># 存储多个数据</div><div class="line">document = [&#123;&apos;x&apos;:3&#125;,&#123;&apos;x&apos;:4&#125;]</div><div class="line">movies.insert_many(document)</div><div class="line"></div><div class="line"># 查找</div><div class="line">movies.find_one(&#123;&apos;x&apos;:1&#125;)</div><div class="line"># 将name和_id取出，1代表取出，0代表不取出</div><div class="line">movies.find(&#123;&#125;,&#123;&apos;name&apos;:1,&apos;_id&apos;:1&#125;):</div><div class="line"># 限制条数，跳过第1条</div><div class="line">find().limit(10).skip(1)</div><div class="line"># 取出所有数据</div><div class="line">arr = []</div><div class="line">for data in movies.find():</div><div class="line">    arr.append(data)</div><div class="line"></div><div class="line"># 更新,如果不存在则新增这个字段</div><div class="line">movies.update_one(&#123;&apos;x&apos;:4&#125;,&#123;&apos;$set&apos;:&#123;&apos;x&apos;:3&#125;&#125;)</div><div class="line"># 更新，删除这个字段</div><div class="line">movies.update_one(&#123;&apos;x&apos;:4&#125;,&#123;&apos;$unset&apos;:&#123;&apos;x&apos;:4&#125;&#125;)</div><div class="line"></div><div class="line"># 删除</div><div class="line">movies.delete_one(&#123;&apos;x&apos;:3&#125;)</div><div class="line"></div><div class="line"># 计数</div><div class="line">movies.count()</div></pre></td></tr></table></figure>
<h4 id="pymongo数据清洗"><a href="#pymongo数据清洗" class="headerlink" title="pymongo数据清洗"></a>pymongo数据清洗</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"># 按照空格分割，分割1次</div><div class="line">str.split(&apos; &apos;,1)</div><div class="line">str -- 分隔符，默认为所有的空字符，包括空格、换行(\n)、制表符(\t)等</div><div class="line">num -- 分割次数</div><div class="line"></div><div class="line"># 将空格替换为无</div><div class="line">str.replace(&apos; &apos;,&apos;&apos;)</div><div class="line"></div><div class="line"># 清洗数据，将名称中的年份分离出来保存到新建year字段中</div><div class="line"> for movie in movies.find(&#123;&#125;,&#123;&apos;name&apos;:1,&apos;_id&apos;:1&#125;):</div><div class="line">     print(movie)</div><div class="line">     if(&apos;(&apos; in movie[&apos;name&apos;]):</div><div class="line">         movies.update(movie,&#123;&apos;$set&apos;:&#123;&apos;name&apos;: movie[&apos;name&apos;].split(&apos;(&apos;)[0], &apos;year&apos;: movie[&apos;name&apos;].split(&apos;(&apos;)[1].split(&apos;)&apos;)[0]&#125;&#125;)</div><div class="line">         </div><div class="line"># 取数据限制条数，跳过哪一条</div><div class="line">limit(10).skip(1)</div></pre></td></tr></table></figure>
<h3 id="Pandas数据分析"><a href="#Pandas数据分析" class="headerlink" title="Pandas数据分析"></a>Pandas数据分析</h3><h4 id="Pandas数据选择"><a href="#Pandas数据选择" class="headerlink" title="Pandas数据选择"></a>Pandas数据选择</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># 索引</div><div class="line">movie.index</div><div class="line"># 选择行</div><div class="line">movie[0:3]</div><div class="line"># 选择列</div><div class="line">movie[&apos;name&apos;]</div><div class="line">movie.name</div><div class="line"># 选择多列</div><div class="line">movie[[&apos;name&apos;,&apos;role&apos;]]</div></pre></td></tr></table></figure>
<h4 id="DataFrame数据清洗"><a href="#DataFrame数据清洗" class="headerlink" title="DataFrame数据清洗"></a>DataFrame数据清洗</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 取出DataFrame的每一行，然后选择row[1]是各个字段的数据，row[0]是index，然后将下替换为2005</div><div class="line">for row in movietop100.iterrows():</div><div class="line">    row[1][&apos;year&apos;] = row[1][&apos;year&apos;].replace(&apos;下&apos;,&apos;2005&apos;)</div><div class="line">    </div><div class="line"># 将DataFrame中字段值为列表的转化为多个字段,并合并到原DataFrame</div><div class="line">tags = mo.type.apply(pd.Series)</div><div class="line">tags.columns = [&apos;tag1&apos;, &apos;tag2&apos;, &apos;tag3&apos;]</div><div class="line">newdf = pd.concat([mo[:], tags[:]], axis=1)[[&apos;year&apos;, &apos;tag1&apos;, &apos;tag2&apos;, &apos;tag3&apos;]]</div></pre></td></tr></table></figure>
<h4 id="Pandas统计方法"><a href="#Pandas统计方法" class="headerlink" title="Pandas统计方法"></a>Pandas统计方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 按照year字段分组，并计算每组的数量</div><div class="line">movietop100.groupby(&apos;year&apos;).agg(&apos;count&apos;)</div><div class="line"></div><div class="line"># 数据透视表，每一年对应评分的电影名称的透视表格</div><div class="line">movietop100.pivot_table(index=[&quot;year&quot;],columns=[&quot;point&quot;],values=[&quot;name&quot;],aggfunc=&apos;sum&apos;)</div></pre></td></tr></table></figure>
<h4 id="Plotly数据可视化"><a href="#Plotly数据可视化" class="headerlink" title="Plotly数据可视化"></a>Plotly数据可视化</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"># 安装plotly</div><div class="line">conda install plotly</div><div class="line"></div><div class="line"># 导入</div><div class="line">from plotly import offline</div><div class="line">import plotly.graph_objs as go</div><div class="line"></div><div class="line"># 直方图 Bar</div><div class="line">offline.init_notebook_mode()</div><div class="line">data = [go.Bar(</div><div class="line">    x = yeardata.index,</div><div class="line">    y = yeardata._id,</div><div class="line">)]</div><div class="line">offline.iplot(data)</div><div class="line"></div><div class="line"># 电影类型分布饼状图</div><div class="line">data = [go.Pie(</div><div class="line">    labels=datatypes.index,</div><div class="line">    values=datatypes.year</div><div class="line">)]</div><div class="line">offline.iplot(data)</div><div class="line"></div><div class="line">#散点图 Scatter</div><div class="line">offline.init_notebook_mode()</div><div class="line">data = [go.Scatter(</div><div class="line">    x = mo.year,</div><div class="line">    y = mo.pointnum,</div><div class="line">    mode = &quot;markers&quot;,</div><div class="line">    marker = dict(size = mo.point)</div><div class="line">)]</div><div class="line">offline.iplot(data)</div></pre></td></tr></table></figure>
<h3 id="分析结果"><a href="#分析结果" class="headerlink" title="分析结果"></a>分析结果</h3><p>1、Top100电影的年份分布 - 柱状图</p>
<p><img src="/2017/09/30/Scrapy爬虫入门-四-Pandas数据分析Top100电影/1.jpg" alt="1"></p>
<p>2、Top100电影的类型分布 - 饼图</p>
<p><img src="/2017/09/30/Scrapy爬虫入门-四-Pandas数据分析Top100电影/2.jpg" alt="2"></p>
<p>3、Top100电影的评分分布 - 散点图（年份、评分）</p>
<p><img src="/2017/09/30/Scrapy爬虫入门-四-Pandas数据分析Top100电影/3.jpg" alt="3"></p>
<blockquote>
<p>项目地址 <a href="https://github.com/Mihawkmah/Anaconda.Analysis" target="_blank" rel="external">https://github.com/Mihawkmah/Anaconda.Analysis</a></p>
</blockquote>
</div></article></div></main><footer><div class="paginator"><a href="/2017/10/11/店铺选址系统背后的业务逻辑梳理/" class="prev">上一篇</a><a href="/2017/09/21/Scrapy爬虫入门-三-实战爬取时光网Top100电影/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'mihawkmah';
var disqus_identifier = '2017/09/30/Scrapy爬虫入门-四-Pandas数据分析Top100电影/';
var disqus_title = 'Scrapy爬虫入门[四] | Pandas数据分析Top100电影';
var disqus_url = 'http://Mihawkmah.github.io/2017/09/30/Scrapy爬虫入门-四-Pandas数据分析Top100电影/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//mihawkmah.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 - 2018 <a href="http://Mihawkmah.github.io">Mihawkmah</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>